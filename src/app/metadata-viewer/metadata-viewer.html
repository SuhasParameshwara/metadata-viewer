<div class="app-container">
  <header class="app-header compact">
    <div class="header-left">
      <h1>Metadata Viewer 2.0</h1>
      <div class="file-name" *ngIf="selectedFileName">
        {{ selectedFileName }}
      </div>
    </div>

    <div class="header-right">
      <div class="stat-badges" *ngIf="controls.length">
        <span class="badge">
          {{ totalFields }} Fields
        </span>
        <span class="badge">
          {{ totalClauses }} Clauses
        </span>
        <span class="badge">
          {{ totalTables }} Tables
        </span>
      </div>

      <label class="upload-btn">
        Upload Word File
        <input type="file" accept=".doc,.docx" (change)="onFileSelected($event)" />
      </label>
    </div>
  </header>


  <!-- Loading -->
  <div class="loading" *ngIf="loading">
    Processing document...
  </div>

  <!-- Drag & Drop Zone -->
  <div class="drop-zone" *ngIf="!loading && !controls.length" (dragover)="$event.preventDefault()"
    (drop)="onFileDrop($event)">
    <div class="drop-icon">ðŸ“„</div>
    <div class="drop-text">
      Drag & drop a Word file here
    </div>
    <div class="drop-subtext">
      or click "Upload Word File" button
    </div>
  </div>

  <!-- Main layout -->
  <div class="main-layout" *ngIf="controls.length">
    <!-- TREE SIDEBAR -->
    <aside class="sidebar tree-sidebar">
      <ng-container *ngFor="let c of controls">
        <div class="tree-node">
          <div class="tree-row" (click)="toggleNode(c, $event)">
            <span class="tree-toggle" *ngIf="c.children?.length">
              {{ c.expanded ? 'â–¼' : 'â–¶' }}
            </span>

            <span class="tree-label" (click)="selectControl(c); $event.stopPropagation()"
              [class.active]="selectedControl === c">
              {{ c.title }}
            </span>
          </div>

          <div class="tree-children" *ngIf="c.expanded">
            <ng-container *ngTemplateOutlet="treeTemplate; context: { $implicit: c.children }"></ng-container>
          </div>
        </div>
      </ng-container>

      <!-- Recursive template -->
      <ng-template #treeTemplate let-nodes>
        <div *ngFor="let node of nodes" class="tree-node">
          <div class="tree-row" (click)="toggleNode(node, $event)">
            <span class="tree-toggle" *ngIf="node.children?.length">
              {{ node.expanded ? 'â–¼' : 'â–¶' }}
            </span>

            <span class="tree-label" (click)="selectControl(node); $event.stopPropagation()"
              [class.active]="selectedControl === node">
              {{ node.title }}
            </span>
          </div>

          <div class="tree-children" *ngIf="node.expanded">
            <ng-container *ngTemplateOutlet="treeTemplate; context: { $implicit: node.children }"></ng-container>
          </div>
        </div>
      </ng-template>
    </aside>

    <!-- RIGHT PANEL -->
    <section class="content">
      <div class="card" *ngIf="selectedControl">
        <h2 class="card-title">{{ selectedControl.title }}</h2>

        <table class="meta-table">
          <thead>
            <tr>
              <th>Attribute</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let attr of selectedControl.attributes">
              <td class="attr-name">{{ attr.name }}</td>

              <td class="attr-value">
                <!-- Normal attributes -->
                <div *ngIf="attr.name !== 'BaseValue'">
                  {{ attr.value }}
                </div>

                <!-- BaseValue with decode -->
                <div *ngIf="attr.name === 'BaseValue' && selectedControl.title.includes('Clause')"
                  class="base-value-container">
                  <div class="base64-text">
                    {{ attr.value }}
                  </div>

                  <button class="decode-btn" (click)="decodeBaseValue(attr)">
                    Decode
                  </button>

                  <div class="decoded-output" *ngIf="attr.decoded">
                    {{ attr.decoded }}
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>
</div>